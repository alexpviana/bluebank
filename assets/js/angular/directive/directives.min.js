var apontamento=[];app.directive("calendario",function(){return{restrict:"E",replace:true,scope:{selected:"=",inicioCal:"=",mesCalendario:"=",apontamentos:"=",getApontamentos:"&",dtServer:"="},link:function(a){a.selected=_removeTime(a.selected||moment().locale("pt_br"),true);a.month=a.selected.clone();$.post("apontamento/getApontamento",{mes:a.mesCalendario},function(b){apontamento=b;var c=a.selected.clone();c.date(0);_removeTime(c.day(0),true);_buildMonth(a,c,a.month)},"json");a.select=function(b){if(!b.isCurrentMonth){return false}if(a.inicioCal){a.inicioCal=false}a.selected=b.date};a.$watch("selected",function(c,b){a.getApontamentos(c)},true);a.next=function(){var b=a.month.clone();_removeTime(b.month(b.month()+1).date(1),false);a.month.month(a.month.month()+1);_buildMonth(a,b,a.month)};a.previous=function(){var b=a.month.clone();_removeTime(b.month(b.month()-1).date(1),false);a.month.month(a.month.month()-1);_buildMonth(a,b,a.month)}},templateUrl:"pages/directives/calendario.html"}});function _removeTime(b,a){return(a)?b.hour(0).minute(0).second(0).millisecond(0):b.day(0).hour(0).minute(0).second(0).millisecond(0)}function _buildMonth(c,g,e){c.weeks=[];var a=false,b=g.clone(),f=b.month(),d=0;while(!a){c.weeks.push({days:_buildWeek(b.clone(),e)});b.add(1,"w");a=d++>1&&f!==b.month();f=b.month()}}function _buildWeek(a,c){var d=[];for(var b=0;b<7;b++){d.push({name:a.format("dd").substring(0,1),number:a.date(),isCurrentMonth:a.month()===c.month(),isToday:a.isSame(new Date(),"day"),date:a,apontamento:apontamento[a.format("YYYY-MM-DD")]});a=a.clone();a.add(1,"d")}return d}app.directive("horaValida",function(){return{restrict:"A",require:"ngModel",link:function(c,b,a,d){d.$parsers.unshift(function(h){if(h){var g=$(b).val().split(":");var e=parseInt(g[0],10);var f=parseInt(g[1],10);var i=true;if(e>23||f>59||isNaN(e)||isNaN(f)){i=false}d.$setValidity("horaInvalida",i)}return i?h:undefined})}}});