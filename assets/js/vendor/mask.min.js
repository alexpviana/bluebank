angular.module("ui.mask",[]).value("uiMaskConfig",{maskDefinitions:{"9":/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/},clearOnBlur:true}).directive("uiMask",["uiMaskConfig","$parse",function(d,c){function a(e){return e===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(e.type||e.href||~e.tabIndex)}return{priority:100,require:"ngModel",restrict:"A",compile:function b(){var e=d;return function f(P,H,v,U){var Q=false,V=false,n,E,A,i,l,T,o,j,X=v.placeholder,r=v.maxlength,p,q,C,B;function s(Z){if(!angular.isDefined(Z)){return w()}g(Z);if(!Q){return w()}y();D();return true}function t(Z){if(!angular.isDefined(Z)){return}A=Z;if(Q){F()}}function u(Z){if(!Q){return Z}T=h(Z||"");j=m(T);U.$setValidity("mask",j);return j&&T.length?k(T):undefined}function M(Z){if(!Q){return Z}T=h(Z||"");j=m(T);U.$viewValue=T.length?k(T):"";U.$setValidity("mask",j);if(T===""&&v.required){U.$setValidity("required",!U.$error.required)}return j?T:undefined}var N={};if(v.uiOptions){N=P.$eval("["+v.uiOptions+"]");if(angular.isObject(N[0])){N=(function(aa,ab){for(var Z in aa){if(Object.prototype.hasOwnProperty.call(aa,Z)){if(ab[Z]===undefined){ab[Z]=angular.copy(aa[Z])}else{angular.extend(ab[Z],aa[Z])}}}return ab})(e,N[0])}}else{N=e}v.$observe("uiMask",s);if(angular.isDefined(v.uiMaskPlaceholder)){v.$observe("uiMaskPlaceholder",t)}else{v.$observe("placeholder",t)}var S=false;v.$observe("modelViewValue",function(Z){if(Z==="true"){S=true}});P.$watch(v.ngModel,function(aa){if(S&&aa){var Z=c(v.ngModel);Z.assign(P,U.$viewValue)}});U.$formatters.push(u);U.$parsers.push(M);function w(){Q=false;R();if(angular.isDefined(X)){H.attr("placeholder",X)}else{H.removeAttr("placeholder")}if(angular.isDefined(r)){H.attr("maxlength",r)}else{H.removeAttr("maxlength")}H.val(U.$modelValue);U.$viewValue=U.$modelValue;return false}function y(){T=q=h(U.$modelValue||"");o=p=k(T);j=m(T);var Z=j&&T.length?o:"";if(v.maxlength){H.attr("maxlength",n[n.length-1]*2)}if(!angular.isDefined(v.uiMaskPlaceholder)){H.attr("placeholder",A)}H.val(Z);U.$viewValue=Z;U.$setValidity("mask",j)}function D(){if(V){return}H.bind("blur",K);H.bind("mousedown mouseup",I);H.bind("input keyup click focus",F);H.bind("paste",z);V=true}function R(){if(!V){return}H.unbind("blur",K);H.unbind("mousedown",I);H.unbind("mouseup",I);H.unbind("input",F);H.unbind("keyup",F);H.unbind("click",F);H.unbind("focus",F);H.unbind("paste",z);V=false}function m(Z){return Z.length?Z.length>=l:true}function h(ab){var Z="",aa=E.slice();ab=ab.toString();angular.forEach(i,function(ac){ab=ab.replace(ac,"")});angular.forEach(ab.split(""),function(ac){if(aa.length&&aa[0].test(ac)){Z+=ac;aa.shift()}});return Z}function k(aa){var Z="",ab=n.slice();angular.forEach(A.split(""),function(ad,ac){if(aa.length&&ac===ab[0]){Z+=aa.charAt(0)||"_";aa=aa.substr(1);ab.shift()}else{Z+=ad}});return Z}function J(Z){var aa=angular.isDefined(v.uiMaskPlaceholder)?v.uiMaskPlaceholder:v.placeholder;if(typeof aa!=="undefined"&&aa[Z]){return aa[Z]}else{return"_"}}function W(){return A.replace(/[_]+/g,"_").replace(/([^_]+)([a-zA-Z0-9])([^_])/g,"$1$2_$3").split("_")}function g(aa){var ab=0;n=[];E=[];A="";if(typeof aa==="string"){l=0;var Z=false,ad=0,ac=aa.split("");angular.forEach(ac,function(af,ae){if(N.maskDefinitions[af]){n.push(ab);A+=J(ae-ad);E.push(N.maskDefinitions[af]);ab++;if(!Z){l++}}else{if(af==="?"){Z=true;ad++}else{A+=af;ab++}}})}n.push(n.slice().pop()+1);i=W();Q=n.length>1?true:false}function K(){if(N.clearOnBlur){C=0;B=0;if(!j||T.length===0){o="";H.val("");P.$apply(function(){U.$setViewValue("")})}}}function I(Z){if(Z.type==="mousedown"){H.bind("mouseout",x)}else{H.unbind("mouseout",x)}}H.bind("mousedown mouseup",I);function x(){B=O(this);H.unbind("mouseout",x)}function z(){L(this,H.val().length)}function F(aq){aq=aq||{};var ai=aq.which,al=aq.type;if(ai===16||ai===91){return}var ax=H.val(),an=p,ak,ap=h(ax),ac=q,av=Y(this)||0,ae=C||0,ag=av-ae,ar=n[0],aw=n[ap.length]||n.slice().shift(),Z=B||0,aj=O(this)>0,au=Z>0,ab=(ax.length>an.length)||(Z&&ax.length>an.length-Z),aa=(ax.length<an.length)||(Z&&ax.length===an.length-Z),ah=(ai>=37&&ai<=40)&&aq.shiftKey,ad=ai===37,ao=ai===8||(al!=="keyup"&&aa&&(ag===-1)),af=ai===46||(al!=="keyup"&&aa&&(ag===0)&&!au),am=(ad||ao||al==="click")&&av>ar;B=O(this);if(ah||(aj&&(al==="click"||al==="keyup"))){return}if((al==="input")&&aa&&!au&&ap===ac){while(ao&&av>ar&&!G(av)){av--}while(af&&av<aw&&n.indexOf(av)===-1){av++}var at=n.indexOf(av);ap=ap.substring(0,at)+ap.substring(at+1)}ak=k(ap);p=ak;q=ap;H.val(ak);U.$setViewValue(ap);if(ab&&(av<=ar)){av=ar+1}if(am){av--}av=av>aw?aw:av<ar?ar:av;while(!G(av)&&av>ar&&av<aw){av+=am?-1:1}if((am&&av<aw)||(ab&&!G(ae))){av++}C=av;L(this,av)}function G(Z){return n.indexOf(Z)>-1}function Y(Z){if(!Z){return 0}if(Z.selectionStart!==undefined){return Z.selectionStart}else{if(document.selection){if(a(H[0])){Z.focus();var aa=document.selection.createRange();aa.moveStart("character",Z.value?-Z.value.length:0);return aa.text.length}}}return 0}function L(aa,ab){if(!aa){return 0}if(aa.offsetWidth===0||aa.offsetHeight===0){return}if(aa.setSelectionRange){if(a(H[0])){aa.focus();aa.setSelectionRange(ab,ab)}}else{if(aa.createTextRange){var Z=aa.createTextRange();Z.collapse(true);Z.moveEnd("character",ab);Z.moveStart("character",ab);Z.select()}}}function O(Z){if(!Z){return 0}if(Z.selectionStart!==undefined){return(Z.selectionEnd-Z.selectionStart)}if(document.selection){return(document.selection.createRange().text.length)}return 0}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(ab){if(this===null){throw new TypeError()}var ac=Object(this);var Z=ac.length>>>0;if(Z===0){return -1}var ad=0;if(arguments.length>1){ad=Number(arguments[1]);if(ad!==ad){ad=0}else{if(ad!==0&&ad!==Infinity&&ad!==-Infinity){ad=(ad>0||-1)*Math.floor(Math.abs(ad))}}}if(ad>=Z){return -1}var aa=ad>=0?ad:Math.max(Z-Math.abs(ad),0);for(;aa<Z;aa++){if(aa in ac&&ac[aa]===ab){return aa}}return -1}}}}}}]);